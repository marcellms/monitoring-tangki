<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Monitoring Tangki</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; margin: 20px; background: #f5f5f5; }
    h1 { text-align: center; }
    .data-box { display: flex; justify-content: space-around; margin: 20px 0; }
    .card {
      background: #fff; padding: 20px; border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center; flex: 1;
      margin: 0 10px;
    }
    canvas { background: #fff; border-radius: 12px; padding: 10px; }
  </style>
</head>
<body>

<h1>📊 Dashboard Tangki Air</h1>

<div class="data-box">
  <div class="card">
    <h2>📏 Tinggi</h2>
    <p id="jarak_now">0.00 cm</p>
  </div>
  <div class="card">
    <h2>💧 Volume</h2>
    <p id="volume_now">0.00 L</p>
  </div>
  <div class="card">
    <h2>🌡 Suhu</h2>
    <p id="suhu_now">0.00 °C</p>
  </div>
</div>

<h2>Grafik Realtime</h2>
<canvas id="jarakChart" height="150"></canvas>
<canvas id="volumeChart" height="150"></canvas>
<canvas id="suhuChart" height="150"></canvas>

<script>
const ctxJarak = document.getElementById('jarakChart').getContext('2d');
const ctxVolume = document.getElementById('volumeChart').getContext('2d');
const ctxSuhu = document.getElementById('suhuChart').getContext('2d');

const labels = Array.from({length: 30}, (_, i) => '');

const jarakChart = new Chart(ctxJarak, {
  type: 'line',
  data: {
    labels: labels,
    datasets: [{ label: 'Tinggi (cm)', data: [], borderColor: 'blue', tension: 0.4 }]
  },
  options: {
    responsive: true,
    scales: { y: { suggestedMin: 0, suggestedMax: 150 } }
  }
});

const volumeChart = new Chart(ctxVolume, {
  type: 'line',
  data: {
    labels: labels,
    datasets: [{ label: 'Volume (L)', data: [], borderColor: 'green', tension: 0.4 }]
  },
  options: {
    responsive: true,
    scales: { y: { suggestedMin: 0, suggestedMax: 100 } }
  }
});

const suhuChart = new Chart(ctxSuhu, {
  type: 'line',
  data: {
    labels: labels,
    datasets: [{ label: 'Suhu (°C)', data: [], borderColor: 'orange', tension: 0.4 }]
  },
  options: {
    responsive: true,
    scales: { y: { suggestedMin: 20, suggestedMax: 50 } }
  }
});

// Simulasi data MQTT masuk (ganti dengan WebSocket/MQTT client asli nanti)
setInterval(() => {
  const jarak = (Math.random() * 130 + 10).toFixed(2);
  const volume = (Math.random() * 80 + 5).toFixed(2);
  const suhu = (Math.random() * 10 + 25).toFixed(2);

  document.getElementById('jarak_now').innerText = `${jarak} cm`;
  document.getElementById('volume_now').innerText = `${volume} L`;
  document.getElementById('suhu_now').innerText = `${suhu} °C`;

  updateChart(jarakChart, jarak);
  updateChart(volumeChart, volume);
  updateChart(suhuChart, suhu);

}, 1000);

function updateChart(chart, value) {
  if (chart.data.datasets[0].data.length >= 30) {
    chart.data.datasets[0].data.shift();
  }
  chart.data.datasets[0].data.push(value);
  chart.update();
}
</script>

</body>
</html>
